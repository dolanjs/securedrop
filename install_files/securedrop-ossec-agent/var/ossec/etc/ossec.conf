<ossec_config>
  <client>
    <server-hostname>securedrop-monitor-server-alias</server-hostname>
  </client>

  <syscheck>
    <!--
      Alert new files
      Only happens during the non-realtime sysscan
      Like after the daily reboots. Does not occur during the real
      time integrity checks.
      They have a event level 0 currently.
    -->
    <alert_new_files>yes</alert_new_files>

    <!--
      Directories to check
      You will want to use the contents of the apparmor profiles
      for each networked process on the system and monitor the
      directories that they have access to.

      Will need to use a combination of `report_changes="no" and
      the <ignore> statement to prevent information disclosure of
      file and directory names to the content of files.

      Files and directories that change often will need the respective
      <ignore> statement to avoid excessive spam.

      Can also use output of netstat and lsof to verify coverage.
      https://ossec-docs.readthedocs.org/en/latest/manual/syscheck/
    -->

    <!-- Generic directories to monitor -->
    <directories realtime="yes" check_all="yes" report_changes="yes">/bin,/sbin</directories>
    <directories realtime="yes" check_all="yes" report_changes="yes">/usr/lib,/lib</directories>
    <directories realtime="yes" check_all="yes" report_changes="yes">/etc,/usr/bin,/usr/sbin</directories>
    <ignore>/etc/motd</ignore>
    <ignore>/etc/apparmor.d/cache/.features</ignore>
    <ignore>/etc/blkid.tab</ignore>
    <!-- Default files/directories to ignore -->
    <ignore>/etc/mtab</ignore>
    <ignore>/etc/mnttab</ignore>
    <ignore>/etc/hosts.deny</ignore>
    <ignore>/etc/mail/statistics</ignore>
    <ignore>/etc/random-seed</ignore>
    <ignore>/etc/adjtime</ignore>
    <ignore>/etc/httpd/logs</ignore>
    <ignore>/etc/utmpx</ignore>
    <ignore>/etc/wtmpx</ignore>
    <ignore>/etc/cups/certs</ignore>
    <ignore>/etc/dumpdates</ignore>
    <ignore>/etc/svc/volatile</ignore>

    <!-- SecureDrop application specific -->
    <directories realtime="yes" check_all="yes" report_changes="yes">/run/lock/apache2,/run/apache2,</directories>
    <directories realtime="yes" check_all="yes" report_changes="yes">/var/run/apache2,/var/log/apache2</directories>
    <ignore>/var/log/apache2/document-access.log</ignore>
    <ignore>/var/log/apache2/document-error.log</ignore>
    <!--
      Source Int apache logs should be ignored in staging env
    -->
    <directories realtime="yes" check_all="yes" report_changes="yes">/var/www</directories>
    <ignore>/var/www/securedrop/securedrop.log</ignore>

    <directories realtime="yes" check_all="yes" report_changes="yes">/var/lib/securedrop</directories>
    <ignore>/var/lib/securedrop/keys/pubring.gpg</ignore>
    <ignore>/var/lib/securedrop/keys/secring.gpg</ignore>
    <ignore>/var/lib/securedrop/keys/trustdb.gpg</ignore>
    <ignore>/var/lib/securedrop/keys/trustdb.gpg</ignore>
    <ignore>/var/lib/securedrop/store</ignore>
    <ignore>/var/lib/securedrop/db.sqlite</ignore>

    <!-- OSSEC agent specific-->
    <directories realtime="yes" check_all="yes" report_changes="yes">/var/ossec</directories>
    <ignore>/var/ossec/queue</ignore>
    <ignore>/var/ossec/logs</ignore>
    <ignore>/var/ossec/stats</ignore>
    <ignore>/var/ossec/var</ignore>

    <!-- Tor
      Do not cache the contents of the tor directory that contains
      secret values. Do not want the contents of these files being
      processed by OSSEC and emailed. We do want to ensure that
      the metadata associated to the file does not change.
    -->
    <directories realtime="yes" check_all="yes" report_changes="no">/var/lib/tor</directories>
    <ignore>/var/lib/tor/cached-certs</ignore>
    <ignore>/var/lib/tor/cached-microdesc-consensus</ignore>
    <ignore>/var/lib/tor/cached-microdescs</ignore>
    <ignore>/var/lib/tor/cached-microdescs.new</ignore>
    <ignore>/var/lib/tor/lock</ignore>
    <ignore>/var/lib/tor/state</ignore>

    <!-- Redis -->
    <!-- ssh -->
    <!-- ntp -->
    <!-- dns -->
  </syscheck>

  <rootcheck>
    <rootkit_files>/var/ossec/etc/shared/rootkit_files.txt</rootkit_files>
    <rootkit_trojans>/var/ossec/etc/shared/rootkit_trojans.txt</rootkit_trojans>
    <system_audit>/var/ossec/etc/shared/system_audit_rcl.txt</system_audit>
    <system_audit>/var/ossec/etc/shared/cis_debian_linux_rcl.txt</system_audit>
  </rootcheck>

  <active-response>
    <disabled>yes</disabled>
  </active-response>


  <!-- Log files to monitor -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/auth.log</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/syslog</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/kern.log</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/dpkg.log</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/cron-apt/log</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/apt/history.log</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/tor/log</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/apache2/source-error.log</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/apache2/source-access.log</location>
  </localfile>

  <localfile>
   <log_format>syslog</log_format>
   <location>/var/log/apache2/document-error.log</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/apache2/document-access.log</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/www/securedrop/securedrop.log</location>
  </localfile>

  <!-- Command output to monitor -->
  <localfile>
    <log_format>command</log_format>
    <command>df -h</command>
  </localfile>

  <localfile>
    <log_format>full_command</log_format>
    <command>netstat -tan |grep LISTEN |grep -v 127.0.0.1 | sort</command>
  </localfile>

  <localfile>
    <log_format>full_command</log_format>
    <command>last -n 5</command>
  </localfile>
</ossec_config>
